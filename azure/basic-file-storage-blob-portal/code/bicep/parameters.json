{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "storageAccountName": {
      "value": "sa${uniqueString(resourceGroup().id)}"
    },
    "location": {
      "value": "${resourceGroup().location}"
    },
    "skuName": {
      "value": "Standard_LRS"
    },
    "accessTier": {
      "value": "Hot"
    },
    "minimumTlsVersion": {
      "value": "TLS1_2"
    },
    "principalId": {
      "value": "${az.getCurrentUser().objectId}"
    },
    "principalType": {
      "value": "User"
    },
    "containerNames": {
      "value": [
        "documents",
        "images",
        "backups"
      ]
    },
    "tags": {
      "value": {
        "purpose": "demo",
        "environment": "learning",
        "recipe": "basic-file-storage-blob-portal",
        "costCenter": "training",
        "createdBy": "bicep-template",
        "createdDate": "${utcNow('yyyy-MM-dd')}"
      }
    },
    "blobSoftDeleteRetentionDays": {
      "value": 7
    },
    "containerSoftDeleteRetentionDays": {
      "value": 7
    },
    "enableVersioning": {
      "value": true
    },
    "enableChangeFeed": {
      "value": false
    }
  },
  "_description": {
    "template": "Azure Basic File Storage with Blob Storage and Portal",
    "version": "1.0",
    "recipe": "basic-file-storage-blob-portal",
    "purpose": "Creates a secure Azure Storage account with blob containers and proper RBAC configuration",
    "deployment": {
      "command": "az deployment group create --resource-group <resource-group> --template-file main.bicep --parameters @parameters.json",
      "prerequisites": [
        "Azure CLI installed and authenticated",
        "Resource group created",
        "Appropriate Azure permissions for storage account creation and RBAC assignments"
      ]
    },
    "parameters": {
      "storageAccountName": {
        "description": "Globally unique name for the storage account (3-24 characters, lowercase letters and numbers only)",
        "example": "mystorageaccount001",
        "required": true,
        "validation": "Must be unique across all Azure storage accounts globally"
      },
      "location": {
        "description": "Azure region for deployment",
        "example": "eastus, westus2, westeurope",
        "default": "Uses resource group location",
        "required": false
      },
      "skuName": {
        "description": "Storage account performance and replication type",
        "options": [
          "Standard_LRS - Locally redundant storage (lowest cost)",
          "Standard_ZRS - Zone-redundant storage (higher availability)",
          "Standard_GRS - Geo-redundant storage (disaster recovery)",
          "Standard_RAGRS - Read-access geo-redundant storage",
          "Premium_LRS - Premium locally redundant storage (high performance)"
        ],
        "default": "Standard_LRS",
        "recommendation": "Standard_LRS for learning/demo, Standard_ZRS or GRS for production"
      },
      "accessTier": {
        "description": "Default access tier for blob storage",
        "options": [
          "Hot - Frequently accessed data (higher storage cost, lower access cost)",
          "Cool - Infrequently accessed data (lower storage cost, higher access cost)"
        ],
        "default": "Hot",
        "recommendation": "Hot for active data, Cool for archival data"
      },
      "minimumTlsVersion": {
        "description": "Minimum TLS version for security compliance",
        "options": [
          "TLS1_0 - Legacy support (not recommended)",
          "TLS1_1 - Deprecated (not recommended)",
          "TLS1_2 - Current security standard (recommended)"
        ],
        "default": "TLS1_2",
        "requirement": "TLS1_2 required by Azure security best practices"
      },
      "principalId": {
        "description": "Object ID of the user, group, or service principal to grant storage access",
        "example": "12345678-1234-1234-1234-123456789012",
        "required": true,
        "howToFind": "Run 'az ad signed-in-user show --query id --output tsv' for current user"
      },
      "principalType": {
        "description": "Type of security principal being granted access",
        "options": [
          "User - Individual user account",
          "Group - Microsoft Entra ID group",
          "ServicePrincipal - Application or service identity"
        ],
        "default": "User",
        "requirement": "Must match the type of the specified principalId"
      },
      "containerNames": {
        "description": "Array of blob container names to create",
        "default": "['documents', 'images', 'backups']",
        "validation": "Container names must be 3-63 characters, lowercase letters, numbers, and hyphens only",
        "example": "['data', 'logs', 'temp', 'archive']"
      },
      "tags": {
        "description": "Resource tags for governance and cost management",
        "recommendation": "Include purpose, environment, owner, and cost center tags",
        "example": {
          "purpose": "file-storage",
          "environment": "production",
          "owner": "data-team",
          "costCenter": "IT-001"
        }
      },
      "blobSoftDeleteRetentionDays": {
        "description": "Number of days to retain deleted blobs",
        "default": 7,
        "range": "1-365 days",
        "recommendation": "7-30 days for development, 30-90 for production"
      },
      "containerSoftDeleteRetentionDays": {
        "description": "Number of days to retain deleted containers",
        "default": 7,
        "range": "1-365 days",
        "requirement": "Must be less than or equal to blob soft delete retention"
      },
      "enableVersioning": {
        "description": "Enable blob versioning for point-in-time recovery",
        "default": true,
        "recommendation": "Enable for production workloads to protect against accidental changes"
      },
      "enableChangeFeed": {
        "description": "Enable change feed for auditing and monitoring blob operations",
        "default": false,
        "note": "Enabling change feed incurs additional storage costs"
      }
    },
    "costEstimates": {
      "storageAccount": "$0.00 monthly base cost",
      "dataStorage": "$0.0208 per GB/month for Hot tier (first 50TB)",
      "transactions": "$0.0004 per 10,000 transactions",
      "dataTransfer": "First 5GB free per month, then varies by region",
      "softDelete": "Additional storage cost for deleted data retention",
      "versioning": "Additional storage cost for maintaining blob versions",
      "example": "Typical demo usage: <$1/month for small file storage testing"
    },
    "securityFeatures": {
      "tls": "TLS 1.2 minimum version enforced",
      "publicAccess": "Blob public access disabled by default",
      "encryption": "Data encrypted at rest with Microsoft-managed keys",
      "rbac": "Microsoft Entra ID authentication with least privilege roles",
      "softDelete": "Protection against accidental deletion",
      "versioning": "Point-in-time recovery capabilities"
    },
    "postDeployment": {
      "verification": [
        "Check storage account creation in Azure Portal",
        "Verify blob containers are accessible via portal",
        "Test file upload/download operations",
        "Confirm RBAC permissions are working"
      ],
      "nextSteps": [
        "Upload test files to containers",
        "Configure lifecycle management policies",
        "Set up monitoring and alerts",
        "Review and adjust access policies as needed"
      ]
    }
  }
}