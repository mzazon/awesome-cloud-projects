{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Infrastructure Inventory Dashboard\n\nThis dashboard provides comprehensive visibility into your Azure infrastructure using Azure Resource Graph queries.\n\n## Overview\n\nUse the queries below to explore your infrastructure inventory, analyze resource distribution, and monitor compliance with organizational policies."
      },
      "name": "text - dashboard-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| summarize \n    TotalResources = count(),\n    UniqueResourceTypes = dcount(type),\n    UniqueLocations = dcount(location),\n    UniqueSubscriptions = dcount(subscriptionId)\n| project \n    \"Total Resources\" = TotalResources,\n    \"Resource Types\" = UniqueResourceTypes,\n    \"Locations\" = UniqueLocations,\n    \"Subscriptions\" = UniqueSubscriptions",
        "size": 3,
        "title": "Infrastructure Summary",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Column",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Value",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "name": "query - infrastructure-summary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| summarize ResourceCount = count() by ResourceType = type\n| order by ResourceCount desc\n| limit 10",
        "size": 0,
        "title": "Top 10 Resource Types",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "piechart"
      },
      "name": "query - top-resource-types"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| where location != ''\n| summarize ResourceCount = count() by Location = location\n| order by ResourceCount desc",
        "size": 0,
        "title": "Resource Distribution by Location",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "barchart"
      },
      "name": "query - location-distribution"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| extend TagCount = array_length(todynamic(tags))\n| extend HasTags = case(TagCount > 0, 'Tagged', 'Untagged')\n| summarize ResourceCount = count() by HasTags\n| extend Percentage = round(100.0 * ResourceCount / toscalar(Resources | count()), 1)",
        "size": 0,
        "title": "Resource Tagging Compliance",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "piechart"
      },
      "name": "query - tagging-compliance"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| where tags !has 'Environment' or tags !has 'Owner'\n| project \n    ResourceName = name,\n    ResourceType = type,\n    ResourceGroup = resourceGroup,\n    Location = location,\n    MissingTags = case(\n        tags !has 'Environment' and tags !has 'Owner', 'Environment, Owner',\n        tags !has 'Environment', 'Environment',\n        tags !has 'Owner', 'Owner',\n        'None'\n    )\n| order by ResourceType asc, ResourceName asc\n| limit 50",
        "size": 0,
        "title": "Resources Missing Required Tags",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "MissingTags",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Environment, Owner",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "!=",
                    "thresholdValue": "Environment, Owner",
                    "representation": "warning",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "ResourceType",
              "sortOrder": 1
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "ResourceType",
            "sortOrder": 1
          }
        ]
      },
      "name": "query - missing-tags"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\n| summarize ResourceCount = count() by \n    SubscriptionId = subscriptionId,\n    ResourceGroup = resourceGroup\n| join kind=inner (\n    ResourceContainers\n    | where type == 'microsoft.resources/subscriptions'\n    | project SubscriptionId = subscriptionId, SubscriptionName = name\n) on SubscriptionId\n| project \n    SubscriptionName,\n    ResourceGroup,\n    ResourceCount\n| order by SubscriptionName asc, ResourceCount desc",
        "size": 0,
        "title": "Resource Count by Subscription and Resource Group",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ResourceCount",
              "formatter": 3,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ],
          "filter": true,
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "SubscriptionName"
            ],
            "expandTopLevel": true
          }
        }
      },
      "name": "query - subscription-resource-groups"
    },
    {
      "type": 1,
      "content": {
        "json": "## Custom Queries\n\nUse the Resource Graph Explorer in the Azure Portal to run custom queries and export results. The infrastructure deployed by this solution includes:\n\n- **Storage Account**: For storing exported inventory reports\n- **Function App**: For automated inventory report generation\n- **Key Vault**: For secure storage of connection strings\n- **Managed Identity**: With Reader access for Resource Graph queries\n- **Log Analytics Workspace**: For monitoring and alerting\n\n### Sample Export Query\n\n```kql\nResources\n| project \n    ResourceName = name,\n    ResourceType = type,\n    Location = location,\n    ResourceGroup = resourceGroup,\n    SubscriptionId = subscriptionId,\n    Tags = tags,\n    ResourceId = id\n| order by ResourceType asc, ResourceName asc\n```"
      },
      "name": "text - custom-queries-help"
    }
  ],
  "styleSettings": {
    "spacingStyle": "narrow"
  },
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}