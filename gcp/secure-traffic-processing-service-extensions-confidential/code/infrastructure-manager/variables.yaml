# Variables for Secure Traffic Processing Infrastructure Manager Configuration
# These variables allow customization of the deployment for different environments

# Project and location configuration
project_id:
  description: "Google Cloud project ID where resources will be created"
  type: string
  default: ""  # Must be provided during deployment

region:
  description: "Google Cloud region for resource deployment"
  type: string
  default: "us-central1"
  pattern: "^[a-z0-9-]+$"

zone:
  description: "Google Cloud zone for Confidential VM deployment"
  type: string
  default: "us-central1-a"
  pattern: "^[a-z0-9-]+$"

# Environment and naming configuration
environment:
  description: "Environment name for resource labeling and organization"
  type: string
  default: "production"
  enum:
    - "development"
    - "staging"
    - "production"
    - "demo"

random_suffix:
  description: "Random suffix for resource names to ensure uniqueness"
  type: string
  default: ""  # Generated externally or provided during deployment
  pattern: "^[a-f0-9]{6}$"

# Confidential VM configuration
vm_machine_type:
  description: "Machine type for Confidential VM (must support Confidential Computing)"
  type: string
  default: "n2d-standard-4"
  enum:
    - "n2d-standard-2"
    - "n2d-standard-4"
    - "n2d-standard-8"
    - "n2d-standard-16"
    - "n2d-highmem-2"
    - "n2d-highmem-4"
    - "n2d-highmem-8"

vm_boot_disk_size:
  description: "Boot disk size in GB for Confidential VM"
  type: integer
  default: 50
  minimum: 20
  maximum: 500

vm_boot_disk_type:
  description: "Boot disk type for Confidential VM"
  type: string
  default: "pd-ssd"
  enum:
    - "pd-standard"
    - "pd-ssd"
    - "pd-balanced"

# Confidential Computing configuration
confidential_compute_type:
  description: "Type of Confidential Computing protection"
  type: string
  default: "SEV_SNP"
  enum:
    - "SEV"
    - "SEV_SNP"
    - "TDX"  # Intel TDX (where available)

# Network security configuration
allowed_source_ranges:
  description: "Source IP ranges allowed to access traffic processor"
  type: array
  default:
    - "10.0.0.0/8"
    - "172.16.0.0/12"
    - "192.168.0.0/16"
  items:
    type: string
    pattern: "^\\d+\\.\\d+\\.\\d+\\.\\d+/\\d+$"

traffic_processor_port:
  description: "Port for traffic processor gRPC service"
  type: integer
  default: 8080
  minimum: 1024
  maximum: 65535

# Load balancer configuration
ssl_certificate_domains:
  description: "Domains for SSL certificate (managed certificates)"
  type: array
  default:
    - "secure-traffic.example.com"
  items:
    type: string
    pattern: "^[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"

load_balancer_timeout:
  description: "Load balancer timeout in seconds"
  type: integer
  default: 30
  minimum: 1
  maximum: 86400

# Health check configuration
health_check_interval:
  description: "Health check interval in seconds"
  type: integer
  default: 30
  minimum: 1
  maximum: 300

health_check_timeout:
  description: "Health check timeout in seconds"
  type: integer
  default: 10
  minimum: 1
  maximum: 300

health_check_healthy_threshold:
  description: "Number of successful health checks before marking healthy"
  type: integer
  default: 2
  minimum: 1
  maximum: 10

health_check_unhealthy_threshold:
  description: "Number of failed health checks before marking unhealthy"
  type: integer
  default: 3
  minimum: 1
  maximum: 10

# Backend service configuration
backend_max_utilization:
  description: "Maximum CPU utilization for backend instances"
  type: number
  default: 0.8
  minimum: 0.1
  maximum: 1.0

backend_capacity_scaler:
  description: "Capacity scaler for backend instances"
  type: number
  default: 1.0
  minimum: 0.0
  maximum: 1.0

connection_draining_timeout:
  description: "Connection draining timeout in seconds"
  type: integer
  default: 300
  minimum: 0
  maximum: 3600

# Storage configuration
storage_class:
  description: "Default storage class for Cloud Storage bucket"
  type: string
  default: "STANDARD"
  enum:
    - "STANDARD"
    - "NEARLINE"
    - "COLDLINE"
    - "ARCHIVE"

# Data lifecycle configuration
lifecycle_coldline_age_days:
  description: "Age in days to transition data to COLDLINE storage"
  type: integer
  default: 30
  minimum: 1
  maximum: 365

lifecycle_delete_age_days:
  description: "Age in days to delete data automatically"
  type: integer
  default: 365
  minimum: 1
  maximum: 3650

# KMS configuration
kms_key_rotation_period:
  description: "Automatic key rotation period in seconds (0 to disable)"
  type: integer
  default: 7776000  # 90 days
  minimum: 0
  maximum: 31536000  # 1 year

kms_protection_level:
  description: "Protection level for KMS keys"
  type: string
  default: "SOFTWARE"
  enum:
    - "SOFTWARE"
    - "HSM"

# Service account configuration
service_account_display_name:
  description: "Display name for the Confidential VM service account"
  type: string
  default: "Confidential Traffic Processor Service Account"
  maxLength: 100

# Firewall configuration
firewall_priority:
  description: "Priority for firewall rules (lower numbers have higher priority)"
  type: integer
  default: 1000
  minimum: 0
  maximum: 65534

# Resource labeling
additional_labels:
  description: "Additional labels to apply to all resources"
  type: object
  default: {}
  additionalProperties:
    type: string
    pattern: "^[a-z0-9_-]+$"

# Traffic processing configuration
processor_log_level:
  description: "Log level for traffic processor application"
  type: string
  default: "INFO"
  enum:
    - "DEBUG"
    - "INFO"
    - "WARNING"
    - "ERROR"
    - "CRITICAL"

processor_max_workers:
  description: "Maximum number of worker threads for traffic processor"
  type: integer
  default: 10
  minimum: 1
  maximum: 100

# Development and testing options
enable_startup_script_logging:
  description: "Enable detailed logging for startup script execution"
  type: boolean
  default: true

enable_external_ip:
  description: "Enable external IP for Confidential VM (required for management)"
  type: boolean
  default: true

# Cost optimization settings
use_preemptible_instances:
  description: "Use preemptible instances for cost optimization (not recommended for production)"
  type: boolean
  default: false

# Monitoring and observability
enable_detailed_monitoring:
  description: "Enable detailed monitoring for all resources"
  type: boolean
  default: true

create_monitoring_dashboards:
  description: "Create Cloud Monitoring dashboards for the infrastructure"
  type: boolean
  default: false  # Can be enabled for enhanced observability