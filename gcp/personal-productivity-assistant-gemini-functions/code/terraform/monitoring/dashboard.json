{
  "displayName": "Personal Productivity Assistant - Monitoring Dashboard",
  "mosaicLayout": {
    "tiles": [
      {
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Email Processing Function Invocations",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/executions\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "Invocations/minute"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Invocations per minute",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Function Execution Duration",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/execution_times\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_PERCENTILE_95",
                      "crossSeriesReducer": "REDUCE_MEAN"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "95th percentile duration"
              },
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/execution_times\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_MEAN",
                      "crossSeriesReducer": "REDUCE_MEAN"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "Average duration"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Duration (ms)",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 4,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Function Error Rate",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/executions\" AND metric.labels.status!=\"ok\"",
                    "aggregation": {
                      "alignmentPeriod": "300s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "targetAxis": "Y1",
                "legendTemplate": "Errors per 5 minutes"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Error count",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 4,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Vertex AI API Calls",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"consumed_api\" AND resource.labels.service=\"aiplatform.googleapis.com\" AND metric.type=\"serviceruntime.googleapis.com/api/request_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": [
                        "metric.labels.response_code_class"
                      ]
                    }
                  }
                },
                "plotType": "STACKED_AREA",
                "targetAxis": "Y1",
                "legendTemplate": "API calls - \${metric.labels.response_code_class}"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "API calls per minute",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 8,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Firestore Operations",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"firestore_database\" AND metric.type=\"firestore.googleapis.com/api/request_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": [
                        "metric.labels.op_type"
                      ]
                    }
                  }
                },
                "plotType": "STACKED_AREA",
                "targetAxis": "Y1",
                "legendTemplate": "\${metric.labels.op_type} operations"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Operations per minute",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 8,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Pub/Sub Message Flow",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"pubsub_topic\" AND resource.labels.topic_id=\"email-processing-topic\" AND metric.type=\"pubsub.googleapis.com/topic/send_message_operation_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "Messages published"
              },
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"pubsub_subscription\" AND resource.labels.subscription_id=\"email-processing-sub\" AND metric.type=\"pubsub.googleapis.com/subscription/ack_message_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "Messages acknowledged"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Messages per minute",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 12,
        "width": 12,
        "height": 4,
        "widget": {
          "title": "System Health Summary",
          "scorecard": {
            "timeSeriesQuery": {
              "timeSeriesFilter": {
                "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/executions\"",
                "aggregation": {
                  "alignmentPeriod": "3600s",
                  "perSeriesAligner": "ALIGN_SUM",
                  "crossSeriesReducer": "REDUCE_SUM"
                }
              }
            },
            "sparkChartView": {
              "sparkChartType": "SPARK_LINE"
            },
            "gaugeView": {
              "lowerBound": 0,
              "upperBound": 1000
            }
          }
        }
      },
      {
        "yPos": 16,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Function Memory Utilization",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_function\" AND resource.labels.function_name=\"email-processor\" AND metric.type=\"cloudfunctions.googleapis.com/function/user_memory_bytes\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_MEAN",
                      "crossSeriesReducer": "REDUCE_MEAN"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1",
                "legendTemplate": "Memory usage (bytes)"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Memory (MB)",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 16,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Cloud Scheduler Job Status",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_scheduler_job\" AND resource.labels.job_id=\"email-processing-schedule\" AND metric.type=\"cloudscheduler.googleapis.com/job/run_count\"",
                    "aggregation": {
                      "alignmentPeriod": "300s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": [
                        "metric.labels.response_code"
                      ]
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "targetAxis": "Y1",
                "legendTemplate": "Job runs - \${metric.labels.response_code}"
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "Job runs per 5 minutes",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 20,
        "width": 12,
        "height": 3,
        "widget": {
          "title": "Cost Estimation (Approximate)",
          "text": {
            "content": "**Estimated Monthly Costs:**\n\n• **Cloud Functions**: $5-15 USD (based on 10,000-50,000 invocations)\n• **Vertex AI (Gemini)**: $10-30 USD (based on token usage)\n• **Firestore**: $1-5 USD (document reads/writes)\n• **Pub/Sub**: $1-3 USD (message publishing)\n• **Cloud Storage**: $1-2 USD (function source storage)\n• **Cloud Monitoring**: $0-2 USD (metrics and dashboards)\n\n**Total Estimated Range**: $18-57 USD/month\n\n*Note: Actual costs depend on usage patterns, email volume, and API call frequency.*",
            "format": "MARKDOWN"
          }
        }
      },
      {
        "yPos": 23,
        "width": 12,
        "height": 2,
        "widget": {
          "title": "Quick Actions & Links",
          "text": {
            "content": "**Quick Links:**\n• [Cloud Functions Console](https://console.cloud.google.com/functions?project=${project_id})\n• [Firestore Console](https://console.cloud.google.com/firestore?project=${project_id})\n• [Vertex AI Console](https://console.cloud.google.com/vertex-ai?project=${project_id})\n• [Cloud Scheduler Console](https://console.cloud.google.com/cloudscheduler?project=${project_id})\n• [Pub/Sub Console](https://console.cloud.google.com/cloudpubsub?project=${project_id})\n\n**Troubleshooting:**\n• Check function logs: `gcloud functions logs read email-processor --region=us-central1 --limit=50`\n• Monitor Pub/Sub: `gcloud pubsub topics describe email-processing-topic`",
            "format": "MARKDOWN"
          }
        }
      }
    ]
  },
  "dashboardFilters": [
    {
      "filterType": "RESOURCE_LABEL",
      "labelKey": "project_id",
      "stringValue": "${project_id}"
    }
  ],
  "labels": {
    "project": "personal-productivity-assistant",
    "managed-by": "terraform",
    "recipe-id": "b4f7e2a8"
  }
}